{"remainingRequest":"/Users/macos/Downloads/campus-system/source code/campus-product-view/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Downloads/campus-system/source code/campus-product-view/src/views/admin/Main.vue?vue&type=style&index=0&id=6b581c9a&lang=css","dependencies":[{"path":"/Users/macos/Downloads/campus-system/source code/campus-product-view/src/views/admin/Main.vue","mtime":1767584228004},{"path":"/Users/macos/Downloads/campus-system/source code/campus-product-view/node_modules/css-loader/dist/cjs.js","mtime":1767024825496},{"path":"/Users/macos/Downloads/campus-system/source code/campus-product-view/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1767024828942},{"path":"/Users/macos/Downloads/campus-system/source code/campus-product-view/node_modules/postcss-loader/src/index.js","mtime":1767024825763},{"path":"/Users/macos/Downloads/campus-system/source code/campus-product-view/node_modules/cache-loader/dist/cjs.js","mtime":1767024828976},{"path":"/Users/macos/Downloads/campus-system/source code/campus-product-view/node_modules/vue-loader/lib/index.js","mtime":1767024826361}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQovKiDkv53mjIHljp/mnInnmoRzdHlsZeS4jeWPmCAqLw0K"},{"version":3,"sources":["Main.vue"],"names":[],"mappings":";AA8UA","file":"Main.vue","sourceRoot":"src/views/admin","sourcesContent":["<template>\r\n  <div class=\"admin-dashboard\">\r\n    <!-- 顶部标题栏 -->\r\n    <div class=\"dashboard-header\">\r\n      <div class=\"header-left\">\r\n        <div class=\"header-title\">\r\n          <h1>后台 / 仪表盘</h1>\r\n        </div>\r\n      </div>\r\n      <div class=\"header-right\">\r\n        <el-button type=\"primary\" icon=\"el-icon-refresh\" @click=\"refreshData\">刷新</el-button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 主要指标卡片 - 6个卡片 -->\r\n    <div class=\"metrics-grid\">\r\n      <div class=\"metric-card\" v-for=\"metric in metrics\" :key=\"metric.id\" :class=\"metric.type\">\r\n        <div class=\"metric-icon\" :style=\"{ background: metric.gradient }\">\r\n          <i :class=\"metric.icon\"></i>\r\n        </div>\r\n        <div class=\"metric-content\">\r\n          <div class=\"metric-label\">{{ metric.label }}</div>\r\n          <div class=\"metric-value\">{{ metric.value }}</div>\r\n          <div class=\"metric-trend\" :class=\"metric.trend.type\">\r\n            <i :class=\"metric.trend.icon\"></i>\r\n            {{ metric.trend.value }}%\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 主要内容区域 -->\r\n    <div class=\"dashboard-main\">\r\n      <!-- 左侧主要区域 -->\r\n      <div class=\"main-section\">\r\n        <!-- 商品上架趋势和用户活跃度 -->\r\n        <div class=\"chart-card trend-chart\">\r\n          <div class=\"chart-header\">\r\n            <h2>商品上架趋势和用户活跃度</h2>\r\n            <div class=\"chart-controls\">\r\n              <el-select v-model=\"timeRange\" placeholder=\"选择时间范围\" @change=\"changeTimeRange\" class=\"time-select\">\r\n                <el-option label=\"最近7天\" value=\"7days\"></el-option>\r\n                <el-option label=\"最近30天\" value=\"30days\"></el-option>\r\n                <el-option label=\"本月\" value=\"month\"></el-option>\r\n                <el-option label=\"自定义\" value=\"custom\"></el-option>\r\n              </el-select>\r\n              <el-date-picker\r\n                v-if=\"timeRange === 'custom'\"\r\n                v-model=\"customDateRange\"\r\n                type=\"daterange\"\r\n                range-separator=\"至\"\r\n                start-placeholder=\"开始日期\"\r\n                end-placeholder=\"结束日期\"\r\n                class=\"date-picker\"\r\n                @change=\"fetchTrendData\">\r\n              </el-date-picker>\r\n            </div>\r\n          </div>\r\n          <div class=\"chart-container\" ref=\"trendChart\"></div>\r\n        </div>\r\n\r\n        <!-- 互动统计 -->\r\n        <div class=\"chart-card interaction-chart\">\r\n          <div class=\"chart-header\">\r\n            <h2>互动统计</h2>\r\n          </div>\r\n          <div class=\"chart-container\" ref=\"interactionChart\"></div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 右侧侧边栏 -->\r\n      <div class=\"sidebar-section\">\r\n        <!-- 最新上架商品 -->\r\n        <div class=\"sidebar-card latest-products\">\r\n          <div class=\"sidebar-header\">\r\n            <h3>最新上架商品</h3>\r\n            <el-button type=\"text\" icon=\"el-icon-refresh\" @click=\"fetchLatestProducts\"></el-button>\r\n          </div>\r\n          <div class=\"products-carousel\">\r\n            <el-carousel :interval=\"5000\" type=\"card\" height=\"200px\" v-if=\"latestProducts.length > 0\">\r\n              <el-carousel-item v-for=\"(page, pageIndex) in paginatedProducts\" :key=\"pageIndex\" class=\"carousel-page\">\r\n                <div class=\"product-item\" v-for=\"product in page\" :key=\"product.id\">\r\n                  <img :src=\"product.cover\" alt=\"商品图片\" class=\"product-image\">\r\n                  <div class=\"product-info\">\r\n                    <h4>{{ product.name }}</h4>\r\n                    <p class=\"price\">¥{{ product.price }}</p>\r\n                    <p class=\"date\">{{ formatDate(product.createTime) }}</p>\r\n                  </div>\r\n                </div>\r\n              </el-carousel-item>\r\n            </el-carousel>\r\n            <div v-else class=\"no-data\">暂无最新商品</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport request from '@/utils/request.js'; // 导入axios实例\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      metrics: [], // 动态从后端获取\r\n      trendData: {\r\n        dates: [],\r\n        productShelves: [],\r\n        userActivity: []\r\n      },\r\n      latestProducts: [], // 动态从后端获取\r\n      interactionStats: {}, // 动态从后端获取\r\n      timeRange: '7days',\r\n      customDateRange: [],\r\n      chartInstances: {} // 存储ECharts实例\r\n    };\r\n  },\r\n  computed: {\r\n    paginatedProducts() {\r\n      const pages = [];\r\n      for (let i = 0; i < this.latestProducts.length; i += 2) {\r\n        pages.push(this.latestProducts.slice(i, i + 2));\r\n      }\r\n      return pages;\r\n    }\r\n  },\r\n  mounted() {\r\n    this.fetchAllData(); // 初始加载所有数据\r\n    this.initCharts();\r\n    window.addEventListener('resize', this.resizeCharts);\r\n  },\r\n  beforeDestroy() {\r\n    window.removeEventListener('resize', this.resizeCharts);\r\n    this.disposeCharts();\r\n  },\r\n  methods: {\r\n    async fetchAllData() {\r\n      await Promise.all([\r\n        this.fetchSummary(),\r\n        this.fetchTrendData(),\r\n        this.fetchLatestProducts(),\r\n        this.fetchInteractionStats()\r\n      ]);\r\n      this.updateCharts();\r\n    },\r\n    async fetchSummary() {\r\n      try {\r\n        const response = await request.get('/dashboard/summary');\r\n        if (response.data.code === 200) {\r\n          const summary = response.data.data; // 假设DashboardSummaryVO结构\r\n          // 根据后端返回映射到metrics数组，假设后端返回 { users: 25678, products: 1456, ... }\r\n          this.metrics = [\r\n            {\r\n              id: 1,\r\n              label: '用户总数',\r\n              value: summary.users || 0,\r\n              trend: { type: 'up', value: 12, icon: 'el-icon-top' },\r\n              icon: 'el-icon-user',\r\n              gradient: 'linear-gradient(135deg, #6EE7B7, #34D399)',\r\n              type: 'users'\r\n            },\r\n            {\r\n              id: 2,\r\n              label: '商品总数',\r\n              value: summary.products || 0,\r\n              trend: { type: 'up', value: 8, icon: 'el-icon-top' },\r\n              icon: 'el-icon-shopping-bag-2',\r\n              gradient: 'linear-gradient(135deg, #60A5FA, #3B82F6)',\r\n              type: 'products'\r\n            },\r\n            // ... 类似映射其他指标，根据实际后端VO字段调整\r\n            // 假设有 orders, revenue, interactions, categories\r\n          ];\r\n        }\r\n      } catch (error) {\r\n        console.error('获取汇总数据失败:', error);\r\n        this.$message.error('获取汇总数据失败');\r\n      }\r\n    },\r\n    async fetchTrendData() {\r\n      let params = {};\r\n      if (this.timeRange === 'custom' && this.customDateRange.length === 2) {\r\n        params = {\r\n          startDate: this.formatDateForAPI(this.customDateRange[0]),\r\n          endDate: this.formatDateForAPI(this.customDateRange[1])\r\n        };\r\n      } else {\r\n        params.range = this.timeRange;\r\n      }\r\n      try {\r\n        const response = await request.get('/dashboard/trend', { params });\r\n        if (response.data.code === 200) {\r\n          const trend = response.data.data; // 假设TrendDataVO { dates: [], productShelves: [], userActivity: [] }\r\n          this.trendData = {\r\n            dates: trend.dates || [],\r\n            productShelves: trend.productShelves || [],\r\n            userActivity: trend.userActivity || []\r\n          };\r\n        }\r\n      } catch (error) {\r\n        console.error('获取趋势数据失败:', error);\r\n        this.$message.error('获取趋势数据失败');\r\n      }\r\n    },\r\n    async fetchLatestProducts() {\r\n      try {\r\n        const response = await request.get('/dashboard/latest-products', {\r\n          params: { limit: 6 }\r\n        });\r\n        if (response.data.code === 200) {\r\n          this.latestProducts = response.data.data || []; // List<LatestProductVO> 假设 { id, name, price, cover, createTime }\r\n        }\r\n      } catch (error) {\r\n        console.error('获取最新商品失败:', error);\r\n        this.$message.error('获取最新商品失败');\r\n      }\r\n    },\r\n    async fetchInteractionStats() {\r\n      try {\r\n        const response = await request.get('/dashboard/interaction-stats');\r\n        if (response.data.code === 200) {\r\n          this.interactionStats = response.data.data || {}; // Map<String, Integer> 如 { likes: 123, views: 456, ... }\r\n        }\r\n      } catch (error) {\r\n        console.error('获取互动统计失败:', error);\r\n        this.$message.error('获取互动统计失败');\r\n      }\r\n    },\r\n    refreshData() {\r\n      this.fetchAllData();\r\n      this.$message.success('数据已刷新');\r\n    },\r\n    changeTimeRange() {\r\n      if (this.timeRange !== 'custom') {\r\n        this.customDateRange = [];\r\n        this.fetchTrendData();\r\n      }\r\n    },\r\n    initCharts() {\r\n      this.chartInstances.trend = this.$echarts.init(this.$refs.trendChart);\r\n      this.chartInstances.interaction = this.$echarts.init(this.$refs.interactionChart);\r\n      this.updateCharts();\r\n    },\r\n    updateCharts() {\r\n      // 更新趋势图\r\n      this.chartInstances.trend.setOption({\r\n        title: { show: false },\r\n        tooltip: { trigger: 'axis' },\r\n        legend: {\r\n          data: ['商品上架', '用户活跃度'],\r\n          bottom: 0\r\n        },\r\n        grid: {\r\n          left: '3%',\r\n          right: '4%',\r\n          bottom: '15%',\r\n          containLabel: true\r\n        },\r\n        xAxis: {\r\n          type: 'category',\r\n          data: this.trendData.dates\r\n        },\r\n        yAxis: {\r\n          type: 'value',\r\n          name: '数量'\r\n        },\r\n        series: [\r\n          {\r\n            name: '商品上架',\r\n            type: 'line',\r\n            smooth: true,\r\n            data: this.trendData.productShelves,\r\n            itemStyle: { color: '#3B82F6' }\r\n          },\r\n          {\r\n            name: '用户活跃度',\r\n            type: 'line',\r\n            smooth: true,\r\n            data: this.trendData.userActivity,\r\n            itemStyle: { color: '#10B981' }\r\n          }\r\n        ]\r\n      });\r\n\r\n      // 更新互动统计饼图\r\n      const interactionData = Object.entries(this.interactionStats).map(([name, value]) => ({ name, value }));\r\n      this.chartInstances.interaction.setOption({\r\n        title: { show: false },\r\n        tooltip: { trigger: 'item' },\r\n        legend: {\r\n          orient: 'vertical',\r\n          left: 'left'\r\n        },\r\n        series: [\r\n          {\r\n            name: '互动类型',\r\n            type: 'pie',\r\n            radius: ['40%', '70%'],\r\n            avoidLabelOverlap: false,\r\n            label: {\r\n              show: false,\r\n              position: 'center'\r\n            },\r\n            emphasis: {\r\n              label: {\r\n                show: true,\r\n                fontSize: '18',\r\n                fontWeight: 'bold'\r\n              }\r\n            },\r\n            labelLine: { show: false },\r\n            data: interactionData\r\n          }\r\n        ]\r\n      });\r\n    },\r\n    resizeCharts() {\r\n      Object.values(this.chartInstances).forEach(chart => chart.resize());\r\n    },\r\n    disposeCharts() {\r\n      Object.values(this.chartInstances).forEach(chart => chart.dispose());\r\n    },\r\n    formatDate(date) {\r\n      return new Date(date).toLocaleDateString('zh-CN');\r\n    },\r\n    formatDateForAPI(date) {\r\n      return date.toISOString().split('T')[0]; // YYYY-MM-DD\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n/* 保持原有的style不变 */\r\n</style>"]}]}