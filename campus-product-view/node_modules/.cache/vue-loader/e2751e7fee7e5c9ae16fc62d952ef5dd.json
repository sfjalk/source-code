{"remainingRequest":"/Users/macos/Downloads/campus-system/source code/campus-product-view/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macos/Downloads/campus-system/source code/campus-product-view/src/views/user/PayOrder.vue?vue&type=style&index=0&id=35b440c0&scoped=true&lang=scss","dependencies":[{"path":"/Users/macos/Downloads/campus-system/source code/campus-product-view/src/views/user/PayOrder.vue","mtime":1758037356869},{"path":"/Users/macos/Downloads/campus-system/source code/campus-product-view/node_modules/css-loader/dist/cjs.js","mtime":1767024825496},{"path":"/Users/macos/Downloads/campus-system/source code/campus-product-view/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1767024828942},{"path":"/Users/macos/Downloads/campus-system/source code/campus-product-view/node_modules/postcss-loader/src/index.js","mtime":1767024825763},{"path":"/Users/macos/Downloads/campus-system/source code/campus-product-view/node_modules/sass-loader/dist/cjs.js","mtime":1767024829398},{"path":"/Users/macos/Downloads/campus-system/source code/campus-product-view/node_modules/cache-loader/dist/cjs.js","mtime":1767024828976},{"path":"/Users/macos/Downloads/campus-system/source code/campus-product-view/node_modules/vue-loader/lib/index.js","mtime":1767024826361}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoub3JkZXItY29udGFpbmVyIHsNCiAgICBtYXgtd2lkdGg6IDEyMDBweDsNCiAgICBtYXJnaW46IDAgYXV0bzsNCiAgICBwYWRkaW5nOiAyMHB4Ow0KfQ0KDQoucHJvZHVjdC1jYXJkIHsNCiAgICBtYXJnaW4tYm90dG9tOiAyMHB4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDhweDsNCg0KICAgIC5wcm9kdWN0LWluZm8gew0KICAgICAgICBwYWRkaW5nOiAyMHB4Ow0KICAgIH0NCg0KICAgIC5wcm9kdWN0LWhlYWRlciB7DQogICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgIG1hcmdpbi1ib3R0b206IDIwcHg7DQogICAgfQ0KDQogICAgLnByb2R1Y3QtaW1hZ2Ugew0KICAgICAgICB3aWR0aDogMTIwcHg7DQogICAgICAgIGhlaWdodDogMTIwcHg7DQogICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICAgICAgbWFyZ2luLXJpZ2h0OiAyMHB4Ow0KICAgICAgICBvYmplY3QtZml0OiBjb3ZlcjsNCiAgICB9DQoNCiAgICAucHJvZHVjdC1kZXRhaWxzIHsNCiAgICAgICAgZmxleDogMTsNCg0KICAgICAgICAucHJvZHVjdC10aXRsZSB7DQogICAgICAgICAgICBtYXJnaW46IDAgMCAxMHB4IDA7DQogICAgICAgICAgICBmb250LXNpemU6IDE4cHg7DQogICAgICAgICAgICBjb2xvcjogIzMzMzsNCiAgICAgICAgfQ0KDQogICAgICAgIC5wcmljZS1zZWN0aW9uIHsNCiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDEwcHg7DQoNCiAgICAgICAgICAgIC5wcmljZSB7DQogICAgICAgICAgICAgICAgZm9udC1zaXplOiAyNHB4Ow0KICAgICAgICAgICAgICAgIGNvbG9yOiAjZmY1MDAwOw0KICAgICAgICAgICAgICAgIG1hcmdpbi1yaWdodDogMTBweDsNCiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLmVsLXRhZyB7DQogICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiA4cHg7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAucHJvZHVjdC1tZXRhIHsNCiAgICAgICAgICAgIGNvbG9yOiAjNjY2Ow0KICAgICAgICAgICAgZm9udC1zaXplOiAxNHB4Ow0KDQogICAgICAgICAgICBzcGFuIHsNCiAgICAgICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDE1cHg7DQoNCiAgICAgICAgICAgICAgICBpIHsNCiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiA1cHg7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgLm9yZGVyLXBhcmFtcyB7DQogICAgICAgIG1hcmdpbi10b3A6IDIwcHg7DQoNCiAgICAgICAgLmVsLWZvcm0taXRlbSB7DQogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxNXB4Ow0KICAgICAgICB9DQoNCiAgICAgICAgLmludmVudG9yeS10aXAgew0KICAgICAgICAgICAgbWFyZ2luLWxlZnQ6IDEwcHg7DQogICAgICAgICAgICBjb2xvcjogIzk5OTsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICAgICAgfQ0KDQogICAgICAgIC50b3RhbC1wcmljZSB7DQogICAgICAgICAgICBmb250LXNpemU6IDE4cHg7DQogICAgICAgICAgICBjb2xvcjogI2ZmNTAwMDsNCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQouYWRkcmVzcy1jYXJkIHsNCiAgICBtYXJnaW4tYm90dG9tOiAyMHB4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDhweDsNCg0KICAgIC5jYXJkLWhlYWRlciB7DQogICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICAgICAgcGFkZGluZzogMTVweCAyMHB4Ow0KICAgICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2YwZjBmMDsNCg0KICAgICAgICBoMyB7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICBmb250LXNpemU6IDE2cHg7DQogICAgICAgICAgICBjb2xvcjogIzMzMzsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC5hZGRyZXNzLWxpc3Qgew0KICAgICAgICBwYWRkaW5nOiAxMHB4Ow0KICAgIH0NCg0KICAgIC5hZGRyZXNzLWl0ZW0gew0KICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICBwYWRkaW5nOiAxNXB4Ow0KICAgICAgICBtYXJnaW4tYm90dG9tOiAxMHB4Ow0KICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZTZlNmU2Ow0KICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjNzOw0KICAgICAgICBjdXJzb3I6IHBvaW50ZXI7DQoNCiAgICAgICAgJjpob3ZlciB7DQogICAgICAgICAgICBib3JkZXItY29sb3I6ICM0MDlFRkY7DQogICAgICAgIH0NCg0KICAgICAgICAmLmFjdGl2ZSB7DQogICAgICAgICAgICBib3JkZXItY29sb3I6ICM0MDlFRkY7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmOWZmOw0KICAgICAgICB9DQoNCiAgICAgICAgLmFkZHJlc3MtcmFkaW8gew0KICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAxNXB4Ow0KICAgICAgICB9DQoNCiAgICAgICAgLmFkZHJlc3MtY29udGVudCB7DQogICAgICAgICAgICBmbGV4OiAxOw0KDQogICAgICAgICAgICAuYWRkcmVzcy1pbmZvIHsNCiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiA1cHg7DQogICAgICAgICAgICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogbGVmdDsNCg0KICAgICAgICAgICAgICAgIC5yZWNlaXZlciB7DQogICAgICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDEwcHg7DQogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAucGhvbmUgew0KICAgICAgICAgICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDEwcHg7DQogICAgICAgICAgICAgICAgICAgIGNvbG9yOiAjNjY2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC5hZGRyZXNzLWRldGFpbCB7DQogICAgICAgICAgICAgICAgY29sb3I6ICM2NjY7DQogICAgICAgICAgICAgICAgZm9udC1zaXplOiAxNHB4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLmFkZHJlc3MtYWN0aW9ucyB7DQogICAgICAgICAgICBtYXJnaW4tbGVmdDogMTVweDsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC5lbXB0eS1hZGRyZXNzIHsNCiAgICAgICAgcGFkZGluZzogNDBweCAwOw0KICAgIH0NCn0NCg0KLm9yZGVyLWZvb3RlciB7DQogICAgcG9zaXRpb246IGZpeGVkOw0KICAgIGJvdHRvbTogMDsNCiAgICBsZWZ0OiAwOw0KICAgIHJpZ2h0OiAwOw0KICAgIGJhY2tncm91bmQ6ICNmZmY7DQogICAgYm94LXNoYWRvdzogMCAtMnB4IDEwcHggcmdiYSgwLCAwLCAwLCAwLjEpOw0KICAgIHBhZGRpbmc6IDE1cHggMjBweDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIHotaW5kZXg6IDEwMDsNCg0KICAgIC5vcmRlci1zdW1tYXJ5IHsNCiAgICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7DQoNCiAgICAgICAgLnRvdGFsIHsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTZweDsNCiAgICAgICAgICAgIG1hcmdpbi1yaWdodDogMTVweDsNCg0KICAgICAgICAgICAgLnByaWNlIHsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDIwcHg7DQogICAgICAgICAgICAgICAgY29sb3I6ICNmZjUwMDA7DQogICAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAucXVhbnRpdHkgew0KICAgICAgICAgICAgY29sb3I6ICM2NjY7DQogICAgICAgICAgICBmb250LXNpemU6IDE0cHg7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi5kaWFsb2ctZm9vdGVyIHsNCiAgICB0ZXh0LWFsaWduOiByaWdodDsNCn0NCg0KLnRpcCB7DQogICAgbWFyZ2luLWxlZnQ6IDEwcHg7DQogICAgY29sb3I6ICM5OTk7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KfQ0K"},{"version":3,"sources":["PayOrder.vue"],"names":[],"mappings":";AA4YA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"PayOrder.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\r\n    <div class=\"order-container\">\r\n        <!-- 商品信息卡片 -->\r\n        <el-card class=\"product-card\" shadow=\"never\">\r\n            <div class=\"product-info\">\r\n                <div class=\"product-header\">\r\n                    <img :src=\"product.coverList.split(',')[0]\" class=\"product-image\" alt=\"商品图片\">\r\n                    <div class=\"product-details\">\r\n                        <h3 class=\"product-title\">{{ product.name }}</h3>\r\n                        <div class=\"price-section\">\r\n                            <span class=\"price\">¥{{ product.price }}</span>\r\n                            <el-tag size=\"mini\" :type=\"product.isBargain ? 'warning' : 'info'\">\r\n                                {{ product.isBargain ? '可砍价' : '不支持砍价' }}\r\n                            </el-tag>\r\n                            <el-tag size=\"mini\" type=\"info\">{{ product.oldLevel }}成新</el-tag>\r\n                        </div>\r\n                        <div class=\"product-meta\">\r\n                            <span><i class=\"el-icon-user\"></i> {{ product.userName }}</span>\r\n                            <span><i class=\"el-icon-folder-opened\"></i> {{ product.categoryName }}</span>\r\n                            <span><i class=\"el-icon-box\"></i> 库存 {{ product.inventory }}件</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- 购买参数 -->\r\n                <div class=\"order-params\">\r\n                    <el-form label-width=\"100px\">\r\n                        <el-form-item label=\"购买数量\" required>\r\n                            <el-input-number v-model=\"buyNumber\" :min=\"1\" :max=\"product.inventory\"\r\n                                controls-position=\"right\" size=\"medium\"\r\n                                @change=\"handleQuantityChange\"></el-input-number>\r\n                            <span class=\"inventory-tip\">剩余{{ product.inventory }}件</span>\r\n                        </el-form-item>\r\n                        <el-form-item label=\"商品总价\">\r\n                            <span class=\"total-price\">¥{{ (product.price * buyNumber).toFixed(2) }}</span>\r\n                        </el-form-item>\r\n                        <el-form-item label=\"备注信息\">\r\n                            <el-input type=\"textarea\" :rows=\"3\" placeholder=\"请输入备注信息（选填）\" v-model=\"detail\" resize=\"none\"\r\n                                maxlength=\"100\" show-word-limit></el-input>\r\n                        </el-form-item>\r\n                    </el-form>\r\n                </div>\r\n            </div>\r\n        </el-card>\r\n\r\n        <!-- 地址选择 -->\r\n        <el-card class=\"address-card\" shadow=\"never\">\r\n            <div class=\"card-header\">\r\n                <h3>选择收货地址</h3>\r\n                <el-button type=\"text\" @click=\"showAddDialog\" icon=\"el-icon-plus\">新增地址</el-button>\r\n            </div>\r\n\r\n            <div class=\"address-list\" v-if=\"addressList.length > 0\">\r\n                <el-radio-group v-model=\"selectedAddressId\" class=\"address-radio-group\">\r\n                    <div class=\"address-item\" v-for=\"item in addressList\" :key=\"item.id\"\r\n                        :class=\"{ 'active': selectedAddressId === item.id }\">\r\n                        <el-radio :label=\"item.id\" class=\"address-radio\"></el-radio>\r\n                        <div class=\"address-content\">\r\n                            <div class=\"address-info\">\r\n                                <div class=\"receiver\">{{ item.concatPerson }}</div>\r\n                                <div class=\"phone\">{{ item.concatPhone }}</div>\r\n                                <el-tag v-if=\"item.isDefault\" size=\"mini\" type=\"success\">默认</el-tag>\r\n                            </div>\r\n                            <div class=\"address-detail\">{{ item.getAdr }}</div>\r\n                        </div>\r\n                        <div class=\"address-actions\">\r\n                            <el-button size=\"mini\" @click=\"handleEdit(item)\">编辑</el-button>\r\n                            <el-button size=\"mini\" type=\"text\" @click=\"setDefault(item.id)\" :disabled=\"item.isDefault\">\r\n                                设为默认\r\n                            </el-button>\r\n                        </div>\r\n                    </div>\r\n                </el-radio-group>\r\n            </div>\r\n            <div class=\"empty-address\" v-else>\r\n                <el-empty description=\"暂无收货地址\">\r\n                    <el-button type=\"primary\" size=\"small\" @click=\"showAddDialog\">添加收货地址</el-button>\r\n                </el-empty>\r\n            </div>\r\n        </el-card>\r\n\r\n        <!-- 底部操作栏 -->\r\n        <div class=\"order-footer\">\r\n            <el-button type=\"info\" size=\"medium\" @click=\"goBack\" icon=\"el-icon-arrow-left\">\r\n                返回商品页\r\n            </el-button>\r\n            <div class=\"order-summary\">\r\n                <span class=\"total\">合计：<span class=\"price\">¥{{ (product.price * buyNumber).toFixed(2) }}</span></span>\r\n                <span class=\"quantity\">共{{ buyNumber }}件</span>\r\n            </div>\r\n            <el-button type=\"primary\" size=\"medium\" @click=\"submitOrder\" :disabled=\"!selectedAddressId || submitting\"\r\n                :loading=\"submitting\" icon=\"el-icon-sell\">\r\n                提交订单\r\n            </el-button>\r\n        </div>\r\n\r\n        <!-- 新增/编辑地址对话框 -->\r\n        <el-dialog :title=\"dialogTitle\" :visible.sync=\"dialogVisible\" width=\"600px\" :close-on-click-modal=\"false\">\r\n            <el-form :model=\"addressForm\" :rules=\"rules\" ref=\"addressForm\" label-width=\"100px\" @submit.native.prevent>\r\n                <el-form-item label=\"收件人\" prop=\"concatPerson\">\r\n                    <el-input v-model=\"addressForm.concatPerson\" placeholder=\"请输入收件人姓名\" maxlength=\"20\"\r\n                        show-word-limit></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"联系电话\" prop=\"concatPhone\">\r\n                    <el-input v-model=\"addressForm.concatPhone\" placeholder=\"请输入收件人手机号码\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"收货地址\" prop=\"getAdr\">\r\n                    <el-input type=\"textarea\" v-model=\"addressForm.getAdr\" placeholder=\"请输入详细收货地址\" :rows=\"3\"\r\n                        maxlength=\"100\" show-word-limit></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"默认地址\">\r\n                    <el-switch v-model=\"addressForm.isDefault\"></el-switch>\r\n                    <span class=\"tip\">设为默认地址后，下单时会优先选择</span>\r\n                </el-form-item>\r\n            </el-form>\r\n            <span slot=\"footer\" class=\"dialog-footer\">\r\n                <el-button @click=\"dialogVisible = false\">取消</el-button>\r\n                <el-button type=\"primary\" @click=\"submitAddressForm\" :loading=\"addressSubmitting\">\r\n                    确定\r\n                </el-button>\r\n            </span>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { getUserInfo } from \"@/utils/storage\"\r\nexport default {\r\n    data() {\r\n        return {\r\n            product: {\r\n                id: null,\r\n                name: '',\r\n                price: 0,\r\n                inventory: 0,\r\n                coverList: '',\r\n                isBargain: false,\r\n                oldLevel: '',\r\n                userName: '',\r\n                categoryName: ''\r\n            },\r\n            buyNumber: 1,\r\n            detail: '',\r\n            selectedAddressId: null,\r\n            addressList: [],\r\n            submitting: false,\r\n            addressSubmitting: false,\r\n\r\n            // 地址表单相关\r\n            dialogVisible: false,\r\n            dialogTitle: '新增地址',\r\n            addressForm: {\r\n                id: null,\r\n                concatPerson: '',\r\n                concatPhone: '',\r\n                getAdr: '',\r\n                isDefault: false\r\n            },\r\n            rules: {\r\n                concatPerson: [\r\n                    { required: true, message: '请输入收件人姓名', trigger: 'blur' },\r\n                    { min: 2, max: 20, message: '长度在2到20个字符', trigger: 'blur' }\r\n                ],\r\n                concatPhone: [\r\n                    { required: true, message: '请输入联系电话', trigger: 'blur' },\r\n                    { pattern: /^1[3-9]\\d{9}$/, message: '请输入正确的手机号码', trigger: 'blur' }\r\n                ],\r\n                getAdr: [\r\n                    { required: true, message: '请输入收货地址', trigger: 'blur' },\r\n                    { min: 5, max: 100, message: '长度在5到100个字符', trigger: 'blur' }\r\n                ]\r\n            }\r\n        }\r\n    },\r\n    created() {\r\n        this.initData();\r\n    },\r\n    methods: {\r\n        async initData() {\r\n            await this.fetchProduct();\r\n            await this.fetchAddressList();\r\n        },\r\n\r\n        // 获取商品信息\r\n        async fetchProduct() {\r\n            const productId = this.$route.query.productId;\r\n            if (!productId) {\r\n                this.$message.error('商品信息获取失败');\r\n                this.$router.go(-1);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                const res = await this.$axios.post('/product/query', { id: productId });\r\n                if (res.data.code === 200 && res.data.data.length > 0) {\r\n                    this.product = res.data.data[0];\r\n                    // 初始化购买数量不超过库存\r\n                    this.buyNumber = Math.min(1, this.product.inventory);\r\n                } else {\r\n                    this.$message.error('商品信息获取失败');\r\n                    this.$router.go(-1);\r\n                }\r\n            } catch (error) {\r\n                this.$message.error('商品信息获取失败');\r\n                console.error('获取商品信息失败:', error);\r\n                this.$router.go(-1);\r\n            }\r\n        },\r\n\r\n        // 获取地址列表\r\n        async fetchAddressList() {\r\n            try {\r\n                const userInfo = getUserInfo();\r\n                if (userInfo === null) { // 没登录不用记录\r\n                    this.$notify({\r\n                        duration: 1000,\r\n                        title: '未登录',\r\n                        message: '登录后才可使用下单功能哦',\r\n                        type: 'info'\r\n                    });\r\n                    this.$router.push('/login');\r\n                    return;\r\n                }\r\n\r\n                const res = await this.$axios.post('/address/queryUser', {\r\n                    current: 1,\r\n                    size: 100 // 获取足够多的地址，避免分页\r\n                });\r\n\r\n                if (res.data.code === 200) {\r\n                    this.addressList = res.data.data || [];\r\n                    // 设置默认选中默认地址\r\n                    const defaultAddress = this.addressList.find(item => item.isDefault);\r\n                    if (defaultAddress) {\r\n                        this.selectedAddressId = defaultAddress.id;\r\n                    } else if (this.addressList.length > 0) {\r\n                        this.selectedAddressId = this.addressList[0].id;\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                console.error('获取地址列表失败:', error);\r\n                this.$message.error('地址列表获取失败');\r\n            }\r\n        },\r\n\r\n        // 数量变化处理\r\n        handleQuantityChange(value) {\r\n            if (value > this.product.inventory) {\r\n                this.buyNumber = this.product.inventory;\r\n                this.$message.warning(`购买数量不能超过库存数量`);\r\n            }\r\n        },\r\n\r\n        // 提交订单\r\n        async submitOrder() {\r\n            if (!this.selectedAddressId) {\r\n                this.$message.error('请选择收货地址');\r\n                return;\r\n            }\r\n\r\n            if (this.buyNumber <= 0) {\r\n                this.$message.error('购买数量必须大于0');\r\n                return;\r\n            }\r\n\r\n            if (this.buyNumber > this.product.inventory) {\r\n                this.$message.error('购买数量不能超过库存数量');\r\n                return;\r\n            }\r\n\r\n            this.submitting = true;\r\n\r\n            try {\r\n                const orderData = {\r\n                    productId: this.product.id,\r\n                    buyNumber: this.buyNumber,\r\n                    detail: this.detail,\r\n                    addressId: this.selectedAddressId\r\n                };\r\n\r\n                const res = await this.$axios.post('/orders/save', orderData);\r\n\r\n                if (res.data.code === 200) {\r\n                    this.$message.success('下单成功');\r\n                    this.$router.push({\r\n                        path: '/orders',\r\n                        query: { orderId: res.data.data }\r\n                    });\r\n                } else {\r\n                    this.$message.error(res.data.msg || '下单失败');\r\n                }\r\n            } catch (error) {\r\n                console.error('下单失败:', error);\r\n                this.$message.error('下单失败，请稍后重试');\r\n            } finally {\r\n                this.submitting = false;\r\n            }\r\n        },\r\n\r\n        // 返回商品页\r\n        goBack() {\r\n            this.$router.go(-1);\r\n        },\r\n\r\n        // 显示新增地址对话框\r\n        showAddDialog() {\r\n            this.dialogTitle = '新增地址';\r\n            this.addressForm = {\r\n                id: null,\r\n                concatPerson: '',\r\n                concatPhone: '',\r\n                getAdr: '',\r\n                isDefault: false\r\n            };\r\n            this.dialogVisible = true;\r\n\r\n            this.$nextTick(() => {\r\n                if (this.$refs.addressForm) {\r\n                    this.$refs.addressForm.clearValidate();\r\n                }\r\n            });\r\n        },\r\n\r\n        // 编辑地址\r\n        handleEdit(row) {\r\n            this.dialogTitle = '编辑地址';\r\n            this.addressForm = JSON.parse(JSON.stringify(row));\r\n            this.dialogVisible = true;\r\n\r\n            this.$nextTick(() => {\r\n                if (this.$refs.addressForm) {\r\n                    this.$refs.addressForm.clearValidate();\r\n                }\r\n            });\r\n        },\r\n\r\n        // 提交地址表单\r\n        async submitAddressForm() {\r\n            this.$refs.addressForm.validate(async (valid) => {\r\n                if (!valid) return;\r\n\r\n                this.addressSubmitting = true;\r\n\r\n                try {\r\n                    const formData = {\r\n                        ...this.addressForm\r\n                    };\r\n\r\n                    const api = formData.id ? '/address/update' : '/address/save';\r\n                    const res = await this.$axios.post(api, formData);\r\n\r\n                    if (res.data.code === 200) {\r\n                        this.$message.success(formData.id ? '地址更新成功' : '地址添加成功');\r\n                        this.dialogVisible = false;\r\n                        await this.fetchAddressList();\r\n                    } else {\r\n                        this.$message.error(res.data.msg || '操作失败');\r\n                    }\r\n                } catch (error) {\r\n                    console.error('地址操作失败:', error);\r\n                    this.$message.error('操作失败，请稍后重试');\r\n                } finally {\r\n                    this.addressSubmitting = false;\r\n                }\r\n            });\r\n        },\r\n\r\n        // 设为默认地址\r\n        async setDefault(id) {\r\n            try {\r\n                await this.$confirm('确认设为默认地址吗?', '提示', {\r\n                    confirmButtonText: '确定',\r\n                    cancelButtonText: '取消',\r\n                    type: 'warning'\r\n                });\r\n\r\n                const res = await this.$axios.put('/address/isDefault', {\r\n                    id: id,\r\n                    isDefault: true\r\n                });\r\n\r\n                if (res.data.code === 200) {\r\n                    this.$message.success('设置成功');\r\n                    await this.fetchAddressList();\r\n                } else {\r\n                    this.$message.info(res.data.msg);\r\n                }\r\n            } catch (error) {\r\n                // 用户取消不做处理\r\n            }\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.order-container {\r\n    max-width: 1200px;\r\n    margin: 0 auto;\r\n    padding: 20px;\r\n}\r\n\r\n.product-card {\r\n    margin-bottom: 20px;\r\n    border-radius: 8px;\r\n\r\n    .product-info {\r\n        padding: 20px;\r\n    }\r\n\r\n    .product-header {\r\n        display: flex;\r\n        margin-bottom: 20px;\r\n    }\r\n\r\n    .product-image {\r\n        width: 120px;\r\n        height: 120px;\r\n        border-radius: 4px;\r\n        margin-right: 20px;\r\n        object-fit: cover;\r\n    }\r\n\r\n    .product-details {\r\n        flex: 1;\r\n\r\n        .product-title {\r\n            margin: 0 0 10px 0;\r\n            font-size: 18px;\r\n            color: #333;\r\n        }\r\n\r\n        .price-section {\r\n            margin-bottom: 10px;\r\n\r\n            .price {\r\n                font-size: 24px;\r\n                color: #ff5000;\r\n                margin-right: 10px;\r\n                font-weight: bold;\r\n            }\r\n\r\n            .el-tag {\r\n                margin-right: 8px;\r\n            }\r\n        }\r\n\r\n        .product-meta {\r\n            color: #666;\r\n            font-size: 14px;\r\n\r\n            span {\r\n                margin-right: 15px;\r\n\r\n                i {\r\n                    margin-right: 5px;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    .order-params {\r\n        margin-top: 20px;\r\n\r\n        .el-form-item {\r\n            margin-bottom: 15px;\r\n        }\r\n\r\n        .inventory-tip {\r\n            margin-left: 10px;\r\n            color: #999;\r\n            font-size: 12px;\r\n        }\r\n\r\n        .total-price {\r\n            font-size: 18px;\r\n            color: #ff5000;\r\n            font-weight: bold;\r\n        }\r\n    }\r\n}\r\n\r\n.address-card {\r\n    margin-bottom: 20px;\r\n    border-radius: 8px;\r\n\r\n    .card-header {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        padding: 15px 20px;\r\n        border-bottom: 1px solid #f0f0f0;\r\n\r\n        h3 {\r\n            margin: 0;\r\n            font-size: 16px;\r\n            color: #333;\r\n        }\r\n    }\r\n\r\n    .address-list {\r\n        padding: 10px;\r\n    }\r\n\r\n    .address-item {\r\n        display: flex;\r\n        align-items: center;\r\n        padding: 15px;\r\n        margin-bottom: 10px;\r\n        border: 1px solid #e6e6e6;\r\n        border-radius: 4px;\r\n        transition: all 0.3s;\r\n        cursor: pointer;\r\n\r\n        &:hover {\r\n            border-color: #409EFF;\r\n        }\r\n\r\n        &.active {\r\n            border-color: #409EFF;\r\n            background-color: #f5f9ff;\r\n        }\r\n\r\n        .address-radio {\r\n            margin-right: 15px;\r\n        }\r\n\r\n        .address-content {\r\n            flex: 1;\r\n\r\n            .address-info {\r\n                margin-bottom: 5px;\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: left;\r\n\r\n                .receiver {\r\n                    font-weight: bold;\r\n                    margin-right: 10px;\r\n                    font-size: 14px;\r\n                }\r\n\r\n                .phone {\r\n                    margin-right: 10px;\r\n                    color: #666;\r\n                                        font-size: 14px;\r\n                }\r\n            }\r\n\r\n            .address-detail {\r\n                color: #666;\r\n                font-size: 14px;\r\n            }\r\n        }\r\n\r\n        .address-actions {\r\n            margin-left: 15px;\r\n        }\r\n    }\r\n\r\n    .empty-address {\r\n        padding: 40px 0;\r\n    }\r\n}\r\n\r\n.order-footer {\r\n    position: fixed;\r\n    bottom: 0;\r\n    left: 0;\r\n    right: 0;\r\n    background: #fff;\r\n    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);\r\n    padding: 15px 20px;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    z-index: 100;\r\n\r\n    .order-summary {\r\n        text-align: right;\r\n\r\n        .total {\r\n            font-size: 16px;\r\n            margin-right: 15px;\r\n\r\n            .price {\r\n                font-size: 20px;\r\n                color: #ff5000;\r\n                font-weight: bold;\r\n            }\r\n        }\r\n\r\n        .quantity {\r\n            color: #666;\r\n            font-size: 14px;\r\n        }\r\n    }\r\n}\r\n\r\n.dialog-footer {\r\n    text-align: right;\r\n}\r\n\r\n.tip {\r\n    margin-left: 10px;\r\n    color: #999;\r\n    font-size: 12px;\r\n}\r\n</style>"]}]}